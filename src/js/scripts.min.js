/* Packaged at 2015/12/26 08:33Z. */
/* Designed and developed by Dandy Weng. */
/* http://www.dandyweng.com/ */

skel.init({reset:"full",containers:"100%",viewport:{width:"device-width",scalable:!1},breakpoints:{full:{media:"(min-width: 1679px)"},wide:{media:"(min-width: 1439px)"},narrow:{media:"(max-width: 1024px)"},tablet:{media:"(max-width: 768px)"},mobile:{media:"(max-width: 535px)",grid:{gutters:"20px"}}}}),function(){function j(){return window.pageYOffset||c.scrollTop}function k(){if(d=j(),f&&!a){if(0>d)return!1;window.scrollTo(0,0)}return dw.has(h,"no-trans")?(dw.remove(h,"no-trans"),!1):g?!1:(0>=d&&e?l(0):d>0&&!e&&l(1),void 0)}function l(a){g=!0,a?dw.add(h,"modify"):(f=!0,dw.remove(h,"modify")),setTimeout(function(){e=!e,g=!1,a&&(f=!1)},600)}var d,e,g,a=function(){var a,f,b=-1,c=window.navigator.userAgent,d=c.indexOf("MSIE "),e=c.indexOf("Trident/");return d>0?b=parseInt(c.substring(d+5,c.indexOf(".",d)),10):e>0&&(f=c.indexOf("rv:"),b=parseInt(c.substring(f+3,c.indexOf(".",f)),10)),b>-1?b:a}(),c=window.document.documentElement,h=document.getElementById("body"),i=h.querySelector("button.trigger"),m=j(),f=0===m;m&&(e=!0,dw.add(h,"no-trans"),dw.add(h,"modify")),window.addEventListener("scroll",k),i.addEventListener("click",function(){l("reveal")})}(),jQuery(function(){function d(){console.log("Detecting GFW..."),$.ajax({url:"https://api.instagram.com/oembed/?url=http://instagram.com/p/xcNT9yk3BH",type:"GET",dataType:"jsonp",timeout:2e3,error:function(){return console.log("GFW Detected. //wqnmlgb"),isGFWDetected=!0,c.addClass("gfw-detected"),!0},success:function(){return console.log("GFW Not Detected."),console.log("Loading video from YouTube..."),isGFWDetected=!1,c.addClass("gfw-not-detected"),!1}})}function e(){var a="jpg",b=18;$.getJSON("https://api.camarts.cn/photos/essentials.php?count="+b+"&rate=5&tags=all&locations=china&format=json&suffix="+a+"&jsoncallback=?",function(a){$("#montage").addClass("ready").empty(),$.each(a.items,function(a,b){var c=b.id,d=$("<a/>").attr({href:"http://camarts.cn/"+c,target:"_blank",rel:"external","class":"2u 4u(tablet)","data-location":b.location,"data-camarts-id":b.id,"data-camarts-title":b.title});$("<img/>").attr("src",b.url).appendTo("#montage").wrap(d)}),console.log("Montage Loaded.")})}function f(){NProgress.start();var a=$("#montage a").length,b="jpg",c=18,d=0;$("#montage").removeClass("ready").addClass("reloading"),$("#montage a").children("img").each(function(e){var f=$(this);setTimeout(function(){f.addClass("shuffling"),d++,d==a&&$.getJSON("https://api.camarts.cn/photos/essentials.php?count="+c+"&rate=5&tags=all&locations=china&format=json&suffix="+b+"&jsoncallback=?",function(a){NProgress.set(.618),setTimeout(function(){$("#montage").empty(),$.each(a.items,function(a,b){var c=$("<a/>").attr({href:"http://camarts.cn/"+b.id,target:"_blank",rel:"external","class":"2u 4u(tablet)","data-location":b.location,"data-camarts-id":b.id,"data-camarts-title":b.title});$("<img/>").attr("src",b.url).addClass("shuffling").appendTo("#montage").wrap(c)}),$("#montage").waitForImages(function(){NProgress.done(),console.log("Montage Reloaded."),$("#montage a").children("img").each(function(a){var b=$(this);setTimeout(function(){b.removeClass("shuffling")},100*a)}),$("#montage").removeClass("reloading").addClass("ready")})},300)})},100*e)})}var a=$(document),b=$(window),c=$("html");$body=$("body"),$section=$body.children("section"),lang=c.attr("lang").substr(0,2),sectionTransitionState=!1,isGFWDetected=!1,b.load(function(){NProgress.done(),c.addClass(skel.vars.deviceType+" "+skel.vars.deviceType+skel.vars.deviceVersion),skel.vars.isTouch&&c.addClass("touch-device"),$body.removeClass("init"),e(),d(),b.trigger("resize").trigger("scroll")}),a.on("ready",function(){NProgress.start(),$("img[data-original]").lazyload({effect:"fadeIn"}),$.getScript("https://dn-ssl-v6-res-dandyweng.qbox.me/maps."+lang+".js",function(){$.getJSON("https://www.dandyweng.com/api/map-data.php?lang="+lang+"&show-years=true&jsoncallback=?",function(a){var b=a["items"];$("#maps").vectorMap({map:"chinaMerc",markers:b,backgroundColor:"transparent",zoomOnScroll:!1,zoomMin:.95,focusOn:{x:.5,y:.5,scale:.95},regionStyle:{initial:{fill:"#fff","fill-opacity":1,stroke:"none","stroke-width":0,"stroke-opacity":1},hover:{fill:"#e5e5e5","fill-opacity":.9}},markerStyle:{initial:{fill:"#fd8888",stroke:"#fff"},hover:{fill:"#fd3838",stroke:"#fff","fill-opacity":.8}}})})})}).on("click","[data-action=switch-fullscreen-mode]",function(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}).on("click touchend","[data-action=reload-montage]",function(){f()}).on("click touchend","[data-action=scroll-to-top]",function(){var a=window.opera?"CSS1Compat"==document.compatMode?$("html"):$("body"):$("html, body");a.animate({scrollTop:0},2e3)}).on("click touchend","[data-action=switch-language]",function(){var a=new Date;a.setTime(a.getTime()+31536e6),setExpires="; expires="+a.toGMTString(),setLang="en"==lang?"zh":"en",document.cookie="lang="+setLang+setExpires+"; path=/",location.reload(!0)}).on("click touchend","[data-action=play-video]",function(){var d,a=$(this).data("youku-id"),b=$(this).data("youtube-id");$("#player").removeClass("standby playing").find("iframe").remove(),"https:"==window.location.protocol&&c.hasClass("gfw-detected")?(d=window.open(),d.location.href="http://v.youku.com/v_show/id_"+a+".html",console.log("Failed to load the video over HTTPS. Opening a new window...")):c.hasClass("gfw-detected")?(console.log("Loading video from Youku..."),$("#player").addClass("playing").fadeIn(),$('<iframe src="http://player.youku.com/embed/'+a+'" frameborder="0" quality="high" allowfullscreen></iframe>').prependTo("#player")):(console.log("Loading video from YouTube..."),$("#player").addClass("playing").fadeIn(),$('<iframe src="//www.youtube.com/embed/'+b+'?rel=0" frameborder="0" allowfullscreen></iframe>').prependTo("#player"))}).on("click touchend","#back-sticker",function(){$(this).toggleClass("hidden")}).on("submit","#comment",function(){var a=$(this),b=a.find("textarea").val(),c=$("button#submit").find("i");return $.ajax({url:"post-comment.php",data:a.serialize()+"&action=ajax-comment",type:"post",beforeSend:function(){return a.hasClass("completed")?!1:$.trim(b)?(c.removeClass("icon-send").addClass("icon-spinner"),NProgress.start(),void 0):!1},error:function(b){console.log("Comment Failed to Post: "+b.responseText),c.removeClass("icon-spinner").addClass("icon-error"),a.addClass("wrong"),NProgress.done()},success:function(b){console.log("Comment Posted: "+b),c.removeClass("icon-spinner").addClass("icon-done"),a.addClass("completed").children("div").find("input, textarea").prop("disabled",!0),NProgress.done()}}),!1})});